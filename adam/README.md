# Letter String Domain Term Rewriting System (LSD TRS)

A **Term Rewriting System (TRS)** implementation for the **Letter String Domain (LSD)**, enabling symbolic transformation, pattern matching, and analogical reasoning on letter-string structures.

## Table of Contents

- [Features](#features)
  - [In Progress](#in-progress)
- [Project Structure](#project-structure)
- [Installation](#installation)
  - [Python](#python)
  - [Nix (optional)](#nix-optional)
- [Usage](#usage)
  - [Makefile Targets](#makefile-targets)
  - [Running Tests](#running-tests)
- [Parser](#parser)
- [Core Concepts](#core-concepts)
  - [Terms](#terms)
    - [Var](#var)
    - [Node](#node)
    - [Seq](#seq)
  - [TRS Engine](#trs-engine)
    - [Rule Types](#rule-types)
    - [Pattern Matching](#pattern-matching)
    - [Substitution](#substitution)
- [Utilities](#utilities)
- [Examples](#examples)
- [Testing](#testing)
- [Documentation](#documentation)
- [Contributing](#contributing)
- [License](#license)

---

## Features

- **Rewrite Engine**: Core logic in [lsd/trs.py](lsd/trs.py) for applying rewrite rules.
- **Flexible Variables**: `Var` with `Span(min, max)` bounds (optional, single, variadic) and type-guards.  
  *See* [lsd/term/var.py](lsd/term/var.py) and [lsd/match.py](lsd/match.py).
- **Rule Types**:
  - **TermRule**: direct lhs → rhs substitution.  
    *Implementation*: [lsd/term/rule.py](lsd/term/rule.py)
  - **MethodRule**: rhs generated by Python lambdas.  
    *Definition*: [lsd/methods.py](lsd/methods.py)
- **Parser**: Intuitive string-to-term conversion in [parser.py](parser.py). Supports forms like `Chunk[!X a b c]`.
- **Wildcards**: `_` matches any term.  
  *See* [lsd/term/wildcard.py](lsd/term/wildcard.py).
- **Utilities**: Levenshtein distance in [lsd/util/string.py](lsd/util/string.py).
- **Makefile**: Quick commands for testing, typing, coverage, and docs.  
  *See* [Makefile](Makefile).
- **Examples**: Demonstrations in [lsd/examples.py](lsd/examples.py) and `lsd/other/` (fractals).
- **Testing**: Pytest suite with helper assertions (`assertMatch`, `assertRewrite`) under [tests/](tests/).

### In Progress

- Analogy solver leveraging TRS for LSD problems.
- Custom `LetterStringDomain` class for domain variations.
- Backtracking matcher yielding all valid environments.
- Enhanced failure reporting in pattern matching.
- Rule-priority management.
- Sphinx documentation automation.

---

## Project Structure

```
.
├── lsd/                # TRS core, term definitions, parser, utilities
│   ├── term/           # Var, Node, Seq, wildcard, rule classes
│   ├── trs.py          # TRS engine
│   ├── match.py        # Pattern matcher
│   ├── substitute.py   # Substitution logic
│   └── util/           # Utility functions (string distance, etc.)
├── tests/              # Pytest test suite (+ unittest compatibility)
├── Makefile            # Build, test, coverage, types, docs, etc.
├── pyproject.toml      # Build and dependency configuration
├── shell.nix           # Nix development environment
├── todo.org            # Project tasks and TODOs
└── README.md           # Project overview
```

---

## Installation

### Python

Supported on Python 3.8+. Install via pip:

```bash
pip install .
# or, if using a requirements file:
pip install -r requirements.txt
```

### Nix (optional)

Enter a reproducible shell:

```bash
nix-shell
```

---

## Usage

### Makefile Targets

- **all**: `make all` &mdash; run `test`, `coverage`, `types`, and `docs`.
- **test**: `make test` &mdash; run the full Pytest suite.
- **coverage**: `make coverage` &mdash; generate XML coverage report.
- **test-cov-html**: `make test-cov-html` &mdash; generate and open HTML coverage.
- **types**: `make types` &mdash; run Pyright on `lsd/*.py`.
- **docs**: `make docs` &mdash; build Sphinx docs.
- **docs-auto**: `make docs-auto` &mdash; live-reload docs server.
- **format**: `make format` &mdash; run `isort` and `black`.
- **clean**: `make clean` &mdash; remove caches and build artifacts.
- **zip**: `make zip` &mdash; clean and archive sources to `lsd.zip`.

### Running Tests

```bash
pytest tests/
```

---

## Parser

The parser in [parser.py](parser.py) turns user-friendly strings into TRS terms:

```python
>>> from parser import parse
>>> parse("Chunk[!X a b c]")
Node("Chunk", Var("X"), "a", "b", "c")
```

Designed for readability; each term has its own sub-parser (`parse_var`, `parse_node`, etc.).

---

## Core Concepts

### Terms

- **Var** (`lsd/term/var.py`): `Var(name, span: Span)` binds 0…N values.
- **Node** (`lsd/term/node.py`): `Node(head, *children)` represents M-expressions.
- **Seq** (`lsd/term/seq.py`): Tuple-like sequence of terms.

### TRS Engine

#### Rule Types

- **TermRule**: static lhs → rhs rules.  
- **MethodRule**: dynamic rhs via Python functions.

#### Pattern Matching

Implemented in [lsd/match.py](lsd/match.py):

```python
from lsd.match import match_pattern
env = match_pattern(pattern, target)
``` 

Returns an `Env` dict of tuples on success or `None` on failure.

#### Substitution

Implemented in [lsd/substitute.py](lsd/substitute.py):

```python
from lsd.substitute import substitute
ground = substitute(template, env)
```

---

## Utilities

- **String distance**: Levenshtein algorithm in [lsd/util/string.py](lsd/util/string.py).

---

## Other

Each of these use the TRS to generate 2D fractals.

From [L-system (Wikipedia)](https://en.wikipedia.org/wiki/L-system)

> An L-system or Lindenmayer system is a parallel rewriting system and a type of formal grammar. An L-system consists of an alphabet of symbols that can be used to make strings, a collection of production rules that expand each symbol into some larger string of symbols, an initial "axiom" string from which to begin construction, and a mechanism for translating the generated strings into geometric structures.


- **Cantor Set**: `python -m lsd.other.cantor`  

``` 
> python -m lsd.other.cantor

Cantor set n=1:
X X

Cantor set n=2:
XXX   XXX
X X   X X

Cantor set n=3:
XXXXXXXXX         XXXXXXXXX
XXX   XXX         XXX   XXX
X X   X X         X X   X X

Cantor set n=4:
XXXXXXXXXXXXXXXXXXXXXXXXXXX                           XXXXXXXXXXXXXXXXXXXXXXXXXXX
XXXXXXXXX         XXXXXXXXX                           XXXXXXXXX         XXXXXXXXX
XXX   XXX         XXX   XXX                           XXX   XXX         XXX   XXX
X X   X X         X X   X X                           X X   X X         X X   X X
```

- **Koch Curve**: `python -m lsd.other.koch`

```
> python -m lsd.other.koch

Koch curve n=1:
XX

Koch curve n=2:
 XX
XXXX

Koch curve n=3:
    XX
   XXXX
  XX  XX
 XXX  XXX
XXXX  XXXX

Koch curve n=4:
             XX
            XXXX
           XX  XX
          XXX  XXX
         XXXX  XXXX
        XX        XX
       XXX        XXX
      XXXX        XXXX
     XX              XX
    XXX              XXX
   XXXXXXX        XXXXXXX
  XX  XXXX        XXXX  XX
 XXX  XXXX        XXXX  XXX
XXXX  XXXX        XXXX  XXXX

...
```


See [lsd/other/](lsd/other/) for full scripts and visualizations.

---

## Testing

- Location: [tests/](tests/)  
- Framework: Pytest (backwards-compatible with `unittest`).
- Helper assertions: `assertMatch`, `assertRewrite`, etc.

---

## Documentation

Automatically generated via Sphinx in `docs/`.  
To build locally:

```bash
make docs
```

---

## Contributing

- Write tests for your changes under `tests/`. File names must begin with "test_".

- Ensure code formatting: `make format` if possible.

---

*Last updated: 2025-04-25*

